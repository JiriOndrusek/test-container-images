# Triggers
trigger:
  branches:
    include:
      - 'main'
      - 'release-*'
  tags:
    include:
      - '*'
pr:
  autoCancel: true
  branches:
    include:
      - '*'

# Stages
stages:
  - stage: build
    displayName: build
    jobs:
      - job: 'main_branch_build'
        displayName: 'Build'
        # Set timeout for jobs
        timeoutInMinutes: 60
        # Base system
        pool:
          vmImage: 'Ubuntu-18.04'
        # Pipeline steps
        steps:
          - bash: echo  '$(System.DefaultWorkingDirectory)'
            displayName: "Working Directory"
          - bash: pwd
            displayName: "Trying. :D"
          - bash: ls
            displayName: "Trying again..:D"
          - bash: ls ../
            displayName: "Trying again...:D"
          - bash: ls ../../
            displayName: "Trying again.....:D"
          - bash: make prepare
            displayName: "Download kafka"
          - bash: make docker_build
            displayName: "Build new image"